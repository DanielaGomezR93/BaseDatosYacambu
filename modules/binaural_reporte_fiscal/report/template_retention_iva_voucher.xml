<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="template_retention_iva_voucher">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="retention">
                <t t-call="web.internal_layout">
                    <div class="page">

                        <!--Header-->
                        <div class="container" style="font-size:12px !important;">
                            <div class="row">

                                <div class="col-3">
                                    <img style="max-height:100px;width:200px;float:left" t-if="res_company.logo"
                                         t-att-src="'data:image/png;base64,%s' % to_text(res_company.logo)"/>
                                </div>

                                <div class="col-5">
                                    <div style="width:100%">
                                        <span>AGENTE DE RETENCIÓN</span>
                                    </div>
                                    <div style="width:100%">
                                        <span t-esc="retention.company_id.name"/>
                                    </div>
                                    <div style="width:100%">
                                        <span t-esc="retention.company_id.street"/>
                                    </div>
                                    <div style="width:100%">
                                        <span>Teléfono:</span>
                                        <span t-esc="retention.company_id.phone"/>
                                    </div>
                                    <div style="width:100%">
                                        <span>RIF:</span>
                                        <span t-esc="retention.company_id.vat"/>
                                    </div>
                                </div>

                                <div class="col-4">
                                    <div style="width:100%">
                                        <span>Fecha:</span>
                                        <span t-esc="retention.date_accounting"/>
                                    </div>
                                    <div style="width:100%">
                                        <span>Periodo Fiscal:</span>
                                        <span t-esc="retention.date_accounting"/>
                                    </div>
                                    <div style="width:100%">
                                        <span>Nro Comprobante:</span>
                                        <span t-esc="retention.number"/>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!--Body-->

                        <!--Separator-->
                        <div class="container">
                            <div class="row">
                                <hr class="col-12"/>
                            </div>
                        </div>

                        <!--Title-->
                        <div class="container">
                            <div class="text-center" style="font-weight: bold">
                                <h4>Retenciones de IVA</h4>
                            </div>
                        </div>

                        <!--Information Client-->
                        <div class="container" style="font-size:12px !important;">
                            <div class="row">
                                <div class="col-4">
                                    <span>CONTRIBUYENTE</span>
                                </div>
                                <div class="col-8">
                                    <span t-esc="retention.partner_id.business_name"/>
                                </div>

                            </div>

                            <div class="row">
                                <div class="col-4">
                                    <span>DOMICILIO</span>
                                </div>
                                <div class="col-8">
                                    <span t-esc="retention.partner_id.street"/>
                                    <t t-if="retention.partner_id.street2">
                                        ,
                                        <span t-esc="retention.partner_id.street2"/>
                                    </t>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-4">
                                    <span>RIF</span>
                                </div>
                                <div class="col-8">
                                    <span t-esc="retention.partner_id.prefix_vat+retention.partner_id.vat"/>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-4">
                                    <span>% Retención</span>
                                </div>
                                <div class="col-8">
                                    <spand>
                                        <t t-esc="'{0:,.2f}'.format(retention.partner_id.withholding_type.value).replace('.', ',')"/>
                                    </spand>
                                    <spand>%</spand>
                                </div>
                            </div>
                        </div>

                        <!--Line Retention: Description-->
                        <div style="margin-top:20px;font-size:12px !important;" class="container">
                            <div style="border-top:1px solid black; border-bottom:1px solid black"
                                 class="row text-center">
                                <div class="col-1">TD</div>
                                <div class="col-1">Fecha</div>
                                <div class="col-1">Nro Factura</div>
                                <div class="col-1">Nro ND</div>
                                <div class="col-1">Nro NC</div>
                                <div class="col-1">Nro Control</div>
                                <div class="col-1">Doc.Afectado</div>
                                <div class="col-1">Importe Total</div>
                                <div class="col-1">No gravable</div>
                                <div class="col-1">Base Imponible</div>
                                <div class="col-1">% IVA</div>
                                <div class="col-1">IMPORTE IVA</div>
                                <div class="col-1">Importe Retenido</div>
                            </div>

                        </div>

                        <!--Line Retention: Line-->
                        <div style="margin-top:5px;margin-bottom:5px;font-size:10px !important;" class="container">
                            <div style="border-bottom:1px solid black" class="text-center">
                                <t t-foreach="retention.retention_line" t-as="line">
                                    <div class="row">
                                        <div class="col-1"
                                             style="margin-left:0px !important;margin-right:0px !important;">
                                            <t t-if="line.invoice_type in ['out_invoice','in_invoice']">
                                                <spand>FA</spand>
                                            </t>
                                            <t t-else="">
                                                <t t-if="line.invoice_type == 'in_refund'">
                                                    <spand>NC</spand>
                                                </t>
                                                <t t-else="">
                                                    <spand>ND</spand>
                                                </t>
                                            </t>
                                        </div>
                                        <!-- Fecha Factura -->
                                        <t t-if="line.invoice_id.invoice_date"><!--date_invoice-->
                                            <div class="col-1">
                                                <spand t-esc="line.invoice_id.invoice_date.strftime('%d/%m/%Y')"/>
                                            </div>
                                        </t>
                                        <!-- Nro Factura -->
                                        <div class="col-1"
                                             style="margin-left:0px !important;margin-right:0px !important;">
                                            <t t-if="line.invoice_type in ['out_invoice','in_invoice']">
                                                <spand t-esc="line.invoice_id.name"/>
                                            </t>
                                        </div>
                                        <!-- Nro ND-->
                                        <div class="col-1"
                                             style="margin-left:0px !important;margin-right:0px !important;">
                                            <t t-if="line.invoice_type == 'invoice_id'">
                                                <spand t-esc="line.invoice_id.name"/>
                                            </t>
                                        </div>
                                        <!-- Nro NC -->
                                        <div class="col-1"
                                             style="margin-left:0px !important;margin-right:0px !important;">
                                            <t t-if="line.invoice_type == 'in_debit'">
                                                <spand t-esc="line.invoice_id.name"/>
                                            </t>
                                        </div>
                                        <!-- Nro Control -->

                                        <div class="col-1">
                                            <t t-if="line.invoice_id.correlative">
                                                <spand t-esc="line.invoice_id.correlative"/>
                                            </t>
                                        </div>
                                        <!-- Doc. Afectado -->
                                        <div class="col-1">
                                            <t t-if="line.invoice_id.invoice_origin">
                                                <spand t-esc="line.invoice_id.invoice_origin"/>
                                            </t>
                                        </div>

                                        <!-- Importe total -->
                                        <div class="col-1">
                                            <t t-if="line.invoice_id.amount_total">
                                                <spand t-esc="line.facture_total"/>
                                            </t>
                                        </div>

                                        <!-- No gravable -->
                                        <div class="col-1">
                                            <span>1</span>
                                            <t t-if="line.invoice_id.amount_by_group[-1][0] == 'IVA 0%'">

                                                <spand t-esc="line.invoice_id.amount_by_group[-1][1]"/>
                                            </t>
                                        </div>

                                        <!-- Base imponible-->
                                        <div class="col-1">
                                            <t t-if="line.facture_amount">
                                                <spand t-esc="line.facture_amount"/>
                                            </t>
                                        </div>

                                        <!-- % IVA-->
                                        <div class="col-1">
                                            <t t-if="line.tax_line">
                                                <spand t-esc="line.tax_line"/>
                                            </t>
                                        </div>

                                        <!-- Importe IVA-->
                                        <div class="col-1">
                                            <t t-if="line.tax_line">
                                                <spand t-esc="line.tax_line"/>
                                            </t>
                                        </div>

                                        <!-- Importe Retenido-->
                                        <div class="col-1">
                                            <t t-if="line.retention_amount">
                                                <spand t-esc="line.retention_amount"/>
                                            </t>
                                        </div>

                                    </div>
                                </t>
                            </div>
                        </div>

                        <!--Total-->
                        <div style="margin-top:25px" class="container">

                            <div style="width:40%; float:right">
                                <div style="width:100%; font:14px bold">
                                    <div style="width:40%; float:left">
                                        TOTAL RETENIDO
                                    </div>
                                    <div style="width:60%; float:right" class="text-right">
                                        <spand t-esc="retention.total_tax_ret"
                                               t-options='{"widget": "float", "precision": res_company.currency_id.decimal_places}'/>
                                    </div>
                                </div>
                            </div>

                        </div>

                        <!--Firmas-->
                        <div class="container" style="font-size:14px !important;">
                            <div class="row text-center">
                                <div class="col-5" style="width:35%; margin-top:100px;">
                                    <!--Firma digital-->
                                    <div style="height:120px">
                                        <img style="max-height:120px;width:200px" t-if="retention.get_signature()"
                                             t-att-src="'data:image/png;base64,%s' % to_text(retention.get_signature())"/>
                                    </div>
                                    <!--Firma digital fin-->
                                    <h5 style="text-align: center; margin: 5px 0;border-top: 1px solid #000;width:80%; padding-top:10px;">
                                        <spand t-esc="res_company.name"/>
                                    </h5>
                                </div>
                                <div class="col-5" style="width:30%;margin-top:100px;">
                                    <div style="height:120px"></div>

                                    <h5 style="text-align: center; margin: 5px 0;border-top: 1px solid #000;width:80%; padding-top:10px;">
                                        Recibido por:
                                    </h5>
                                </div>
                            </div>
                        </div>

                    </div>
                </t>
            </t>
        </t>
    </template>
</odoo>